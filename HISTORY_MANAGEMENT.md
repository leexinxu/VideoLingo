# ğŸ“ å†å²æ–‡ä»¶ç®¡ç†

## æ¦‚è¿°

VideoLingoæ’­æ”¾åˆ—è¡¨ç›‘æ§å™¨ç°åœ¨æ”¯æŒæŒ‰æ’­æ”¾åˆ—è¡¨å’Œè§†é¢‘ä¿¡æ¯ç»„ç»‡å†å²æ–‡ä»¶ï¼Œæ–¹ä¾¿ç®¡ç†å’ŒæŸ¥æ‰¾å·²å¤„ç†çš„è§†é¢‘ã€‚

## æ–‡ä»¶ç»„ç»‡ç»“æ„

```
history/
â”œâ”€â”€ ä¸­å­—/                          # ä¸­å­—æ’­æ”¾åˆ—è¡¨
â”‚   â”œâ”€â”€ video_id_1_è§†é¢‘æ ‡é¢˜1/      # è§†é¢‘1çš„æ–‡ä»¶å¤¹
â”‚   â”‚   â”œâ”€â”€ process_info.json      # å¤„ç†ä¿¡æ¯
â”‚   â”‚   â”œâ”€â”€ output_sub.mp4         # å¸¦å­—å¹•çš„è§†é¢‘
â”‚   â”‚   â”œâ”€â”€ output_sub.srt         # å­—å¹•æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ ...                    # å…¶ä»–å¤„ç†æ–‡ä»¶
â”‚   â””â”€â”€ video_id_2_è§†é¢‘æ ‡é¢˜2/      # è§†é¢‘2çš„æ–‡ä»¶å¤¹
â”‚       â”œâ”€â”€ process_info.json
â”‚       â””â”€â”€ ...
â””â”€â”€ ä¸­é…/                          # ä¸­é…æ’­æ”¾åˆ—è¡¨
    â”œâ”€â”€ video_id_3_è§†é¢‘æ ‡é¢˜3/      # è§†é¢‘3çš„æ–‡ä»¶å¤¹
    â”‚   â”œâ”€â”€ process_info.json
    â”‚   â”œâ”€â”€ output_dub.mp4         # å¸¦é…éŸ³çš„è§†é¢‘
    â”‚   â””â”€â”€ ...
    â””â”€â”€ ...
```

## å¤„ç†ä¿¡æ¯æ–‡ä»¶

æ¯ä¸ªè§†é¢‘æ–‡ä»¶å¤¹éƒ½åŒ…å«ä¸€ä¸ª `process_info.json` æ–‡ä»¶ï¼Œè®°å½•å¤„ç†è¯¦æƒ…ï¼š

```json
{
  "video_id": "dQw4w9WgXcQ",
  "video_title": "è§†é¢‘æ ‡é¢˜",
  "playlist_name": "ä¸­å­—",
  "process_time": "2024-01-15T10:30:45.123456",
  "playlist_config": {
    "url": "æ’­æ”¾åˆ—è¡¨URL",
    "dubbing": false,
    "description": "ä¸­å­—æ’­æ”¾åˆ—è¡¨ - ä»…ç¿»è¯‘ç”Ÿæˆå­—å¹•"
  }
}
```

## å†å²ç®¡ç†å·¥å…·

### åŸºæœ¬ä½¿ç”¨

```bash
# åˆ—å‡ºæ‰€æœ‰å­˜æ¡£çš„è§†é¢‘
python history_manager.py

# åˆ—å‡ºç‰¹å®šæ’­æ”¾åˆ—è¡¨çš„è§†é¢‘
python history_manager.py --list --playlist ä¸­å­—

# è·å–ç‰¹å®šè§†é¢‘çš„è¯¦ç»†ä¿¡æ¯
python history_manager.py --info ä¸­å­— video_id_è§†é¢‘æ ‡é¢˜

# æ¸…ç†30å¤©å‰çš„æ—§æ–‡ä»¶
python history_manager.py --clean 30

# å¯¼å‡ºå†å²æ‘˜è¦
python history_manager.py --export summary.json
```

### å‘½ä»¤è¡Œé€‰é¡¹

- `--list, -l`: åˆ—å‡ºå­˜æ¡£çš„è§†é¢‘
- `--playlist, -p`: æŒ‡å®šæ’­æ”¾åˆ—è¡¨åç§°
- `--info, -i`: è·å–ç‰¹å®šè§†é¢‘çš„è¯¦ç»†ä¿¡æ¯
- `--clean, -c`: æ¸…ç†æŒ‡å®šå¤©æ•°å‰çš„æ–‡ä»¶
- `--export, -e`: å¯¼å‡ºå†å²æ‘˜è¦åˆ°æ–‡ä»¶

## ä½¿ç”¨ç¤ºä¾‹

### 1. æŸ¥çœ‹æ‰€æœ‰å­˜æ¡£è§†é¢‘

```bash
python history_manager.py --list
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
ğŸ“ Archived Videos:
================================================================================

ğŸ¬ Playlist: ä¸­å­—
----------------------------------------
   1. ç¤ºä¾‹è§†é¢‘æ ‡é¢˜
      Folder: dQw4w9WgXcQ_ç¤ºä¾‹è§†é¢‘æ ‡é¢˜
      Processed: 2024-01-15 10:30:45
      Files: output_sub.mp4, output_sub.srt

ğŸ¬ Playlist: ä¸­é…
----------------------------------------
   1. å¦ä¸€ä¸ªè§†é¢‘æ ‡é¢˜
      Folder: abc123_å¦ä¸€ä¸ªè§†é¢‘æ ‡é¢˜
      Processed: 2024-01-15 09:15:30
      Files: output_dub.mp4, output_dub.srt
```

### 2. æŸ¥çœ‹ç‰¹å®šæ’­æ”¾åˆ—è¡¨

```bash
python history_manager.py --list --playlist ä¸­å­—
```

### 3. è·å–è§†é¢‘è¯¦ç»†ä¿¡æ¯

```bash
python history_manager.py --info ä¸­å­— dQw4w9WgXcQ_ç¤ºä¾‹è§†é¢‘æ ‡é¢˜
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
ğŸ“¹ Video Information:
==================================================
Title: ç¤ºä¾‹è§†é¢‘æ ‡é¢˜
Video ID: dQw4w9WgXcQ
Playlist: ä¸­å­—
Process Time: 2024-01-15T10:30:45.123456

ğŸ“ Files:
  output_sub.mp4 (15.2 MB)
  output_sub.srt (2.1 MB)
  process_info.json (0.5 KB)
```

### 4. æ¸…ç†æ—§æ–‡ä»¶

```bash
# æ¸…ç†7å¤©å‰çš„æ–‡ä»¶
python history_manager.py --clean 7

# æ¸…ç†30å¤©å‰çš„æ–‡ä»¶
python history_manager.py --clean 30
```

### 5. å¯¼å‡ºæ‘˜è¦

```bash
python history_manager.py --export my_summary.json
```

## é…ç½®é€‰é¡¹

åœ¨ `playlist_monitor_config.json` ä¸­å¯ä»¥é…ç½®å†å²æ–‡ä»¶ç®¡ç†ï¼š

```json
{
  "output_settings": {
    "history_organization": {
      "enabled": true,           // æ˜¯å¦å¯ç”¨å†å²æ–‡ä»¶ç»„ç»‡
      "by_playlist": true,       // æ˜¯å¦æŒ‰æ’­æ”¾åˆ—è¡¨åˆ†ç±»
      "by_video": true,          // æ˜¯å¦æŒ‰è§†é¢‘åˆ†ç±»
      "include_process_info": true, // æ˜¯å¦åŒ…å«å¤„ç†ä¿¡æ¯æ–‡ä»¶
      "auto_cleanup_days": 30    // è‡ªåŠ¨æ¸…ç†å¤©æ•°
    }
  }
}
```

## æ–‡ä»¶å‘½åè§„åˆ™

### è§†é¢‘æ–‡ä»¶å¤¹å‘½å
- æ ¼å¼ï¼š`{video_id}_{safe_title}`
- `video_id`: YouTubeè§†é¢‘ID
- `safe_title`: æ¸…ç†åçš„è§†é¢‘æ ‡é¢˜ï¼ˆç§»é™¤ç‰¹æ®Šå­—ç¬¦ï¼Œé™åˆ¶é•¿åº¦ï¼‰

### å®‰å…¨æ ‡é¢˜å¤„ç†
- ç§»é™¤ç‰¹æ®Šå­—ç¬¦ï¼Œåªä¿ç•™å­—æ¯ã€æ•°å­—ã€ç©ºæ ¼ã€è¿å­—ç¬¦ã€ä¸‹åˆ’çº¿
- é™åˆ¶æ ‡é¢˜é•¿åº¦ä¸º50ä¸ªå­—ç¬¦
- ç§»é™¤æœ«å°¾ç©ºæ ¼

## è‡ªåŠ¨æ¸…ç†

### æ¸…ç†ç­–ç•¥
- é»˜è®¤æ¸…ç†30å¤©å‰çš„æ–‡ä»¶
- åŸºäº `process_info.json` ä¸­çš„å¤„ç†æ—¶é—´
- åªæ¸…ç†æ•´ä¸ªè§†é¢‘æ–‡ä»¶å¤¹ï¼Œä¸ä¼šéƒ¨åˆ†åˆ é™¤

### æ‰‹åŠ¨æ¸…ç†
```bash
# æ¸…ç†æŒ‡å®šå¤©æ•°å‰çš„æ–‡ä»¶
python history_manager.py --clean 7   # 7å¤©å‰
python history_manager.py --clean 30  # 30å¤©å‰
python history_manager.py --clean 90  # 90å¤©å‰
```

## å¤‡ä»½å’Œæ¢å¤

### å¤‡ä»½å†å²æ–‡ä»¶
```bash
# åˆ›å»ºå¤‡ä»½
tar -czf history_backup_$(date +%Y%m%d).tar.gz history/

# æˆ–ä½¿ç”¨zip
zip -r history_backup_$(date +%Y%m%d).zip history/
```

### æ¢å¤å†å²æ–‡ä»¶
```bash
# è§£å‹å¤‡ä»½
tar -xzf history_backup_20240115.tar.gz

# æˆ–ä½¿ç”¨zip
unzip history_backup_20240115.zip
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ–‡ä»¶å¤¹åç§°è¿‡é•¿**
   - ç³»ç»Ÿä¼šè‡ªåŠ¨æˆªæ–­æ ‡é¢˜é•¿åº¦
   - ç¡®ä¿è§†é¢‘IDæ­£ç¡®

2. **ç‰¹æ®Šå­—ç¬¦é—®é¢˜**
   - ç³»ç»Ÿä¼šè‡ªåŠ¨æ¸…ç†ç‰¹æ®Šå­—ç¬¦
   - å¦‚æœä»æœ‰é—®é¢˜ï¼Œæ£€æŸ¥è§†é¢‘æ ‡é¢˜

3. **æƒé™é—®é¢˜**
   - ç¡®ä¿å¯¹historyç›®å½•æœ‰è¯»å†™æƒé™
   - æ£€æŸ¥ç£ç›˜ç©ºé—´

4. **æ–‡ä»¶æŸå**
   - æ£€æŸ¥ `process_info.json` æ–‡ä»¶å®Œæ•´æ€§
   - å¯ä»¥æ‰‹åŠ¨åˆ é™¤æŸåçš„æ–‡ä»¶å¤¹

### è°ƒè¯•å‘½ä»¤

```bash
# æ£€æŸ¥å†å²ç›®å½•ç»“æ„
ls -la history/

# æ£€æŸ¥ç‰¹å®šæ’­æ”¾åˆ—è¡¨
ls -la history/ä¸­å­—/

# æ£€æŸ¥æ–‡ä»¶å¤§å°
du -sh history/*

# æŸ¥æ‰¾æŸåçš„æ–‡ä»¶
find history/ -name "process_info.json" -exec python -m json.tool {} \;
```

## æœ€ä½³å®è·µ

1. **å®šæœŸæ¸…ç†**: å»ºè®®æ¯æœˆæ¸…ç†ä¸€æ¬¡æ—§æ–‡ä»¶
2. **å¤‡ä»½é‡è¦æ–‡ä»¶**: å®šæœŸå¤‡ä»½é‡è¦çš„å¤„ç†ç»“æœ
3. **ç›‘æ§ç£ç›˜ç©ºé—´**: ç¡®ä¿æœ‰è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´
4. **æ£€æŸ¥å¤„ç†è´¨é‡**: å®šæœŸæ£€æŸ¥å¤„ç†ç»“æœçš„è´¨é‡

## é«˜çº§åŠŸèƒ½

### è‡ªå®šä¹‰æ¸…ç†è§„åˆ™
å¯ä»¥ä¿®æ”¹ `history_manager.py` ä¸­çš„æ¸…ç†é€»è¾‘ï¼Œæ·»åŠ è‡ªå®šä¹‰è§„åˆ™ï¼š

```python
def custom_cleanup_rule(self, video_info):
    """è‡ªå®šä¹‰æ¸…ç†è§„åˆ™"""
    # ä¾‹å¦‚ï¼šåªä¿ç•™ç‰¹å®šæ’­æ”¾åˆ—è¡¨çš„æ–‡ä»¶
    if video_info.get('playlist_name') == 'ä¸­å­—':
        return True
    return False
```

### æ‰¹é‡æ“ä½œ
å¯ä»¥ç¼–å†™è„šæœ¬è¿›è¡Œæ‰¹é‡æ“ä½œï¼š

```bash
# æ‰¹é‡é‡å‘½å
for dir in history/ä¸­å­—/*/; do
    # è‡ªå®šä¹‰é‡å‘½åé€»è¾‘
done

# æ‰¹é‡ç§»åŠ¨
mv history/ä¸­å­—/* history/archive/
``` 